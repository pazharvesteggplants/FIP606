{"title":"aula9","markdown":{"yaml":{"title":"aula9","format":"html","editor":"visual"},"headingText":"Análisi de Modelo Mixto, Correlación y Regresión Linear.","containsRefs":false,"markdown":"\n\n\n## Pudrición de maíz.\n\nCada híbrido está dentro de cada bloque, el bloque se aleatorizó dentro de cada bloque.\n\nSe sortean los tratamientos del híbrido y los del método.\n\nSe sortean estos híbridos dentro de cada bloque.\n\nEs una parcela subdivida. ¿Cuándo es una parcela sub-sub dividida? Cuando hay 3 factores.\n\nNuestro modelo estadístico va a ser diferente, no es híbrido vs método+ bloque, se debe utilizar el valor b o utilizar un modelo mixto (mixtura entre un factor fijo y uno aleatorio). Ese es el modelo mixto, es un paquete diferente para estructurar esta situación (efecto aleatorio del híbrido).\n\n## Parcela subdividida\n\n```{r}\nlibrary(tidyverse)\nlibrary(readxl)\nlibrary(gsheet)\nlibrary(ggplot2)\nlibrary(DHARMa)\nlibrary(multcomp)\nlibrary(multcompView)\nlibrary(emmeans)\nmilho <- gsheet2tbl('https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=1345524759')\n```\n\n## Index\n\n```{r}\nmilho |>\n  ggplot(aes(method, index))+\n  geom_jitter(width = 0.1, alpha=0.2)+\n  facet_wrap(~hybrid)+\n  stat_summary(fun.data='mean_cl_boot', size=0.5, color = 'pink')\n```\n\n```{r}\nlibrary(lme4)\n\nmilho<-milho|>\n  mutate(block = as.factor(block))\nmix2<- lmer(index ~ hybrid*method + block+\n              (1|block/hybrid), data = milho)\n\nanova(mix2)\nlibrary(car)\n\n```\n\n1\\|block/hybrid indica la función (con efecto aleatorio). El resultado para la interacción entre híbrido y method es significativa.\n\n### Premisas\n\n```{r}\nlibrary(performance)\ncheck_normality(mix2)\ncheck_heteroscedasticity(mix2)\nsimulate_residuals(mix2)\n```\n\n```{r}\nplot(simulateResiduals(mix2))\nqqnorm(residuals(mix2))\nqqline(residuals(mix2))\nhist(residuals(mix2))\n```\n\n# Test de comparar medias\n\n```{r}\nmedias_milho <- emmeans(mix2,\n                        ~ hybrid | method,\n                        type = \"response\")\n\nmedias_milho2 <- emmeans(mix2,\n                         ~ method | hybrid,\n                         type = \"response\")\n\ncld(medias_milho, Letters = LETTERS)\ncld(medias_milho2, Letters = LETTERS)\n```\n\n```{r}\nlibrary(ggplot2)\nlibrary(Hmisc)\n\nindex <- milho |>\n  ggplot(aes(hybrid, index))+\n  geom_jitter(width = 0.05, color = \n                \"gray\")+\n  stat_summary(fun.data = \n                 \"mean_cl_boot\", size = 0.5, color = \n                 \"red\", alpha = 0.5)\nindex\n\nyield <- milho |>\n  ggplot(aes(hybrid, yield))+\n  geom_jitter(width = 0.05, color = \n                \"gray\")+\n  stat_summary(fun.data = \n                 \"mean_cl_boot\", size = 0.5, color = \n                 \"red\", alpha = 0.5)\nlibrary(ggplot2)\nlibrary(Hmisc)\n\nyield <- milho |>\n  ggplot(aes(hybrid, yield))+\n  geom_jitter(width = 0.05, color = \n                \"gray\")+\n  stat_summary(fun.data = \n                 \"mean_cl_boot\", size = 0.5, color = \n                 \"red\", alpha = 0.5)\n\n```\n\n![](images/clipboard-1362719507.png)\n\n```{r}\nlibrary(performance)\nmilho |> \n  ggplot(aes(method, index))+\n  geom_jitter(width =0.1, alpha = 0.2)+\n  facet_wrap(~ hybrid)+\n  stat_summary(fun.data = \"mean_cl_boot\", size \n               = 0.5, color = \"purple\")\n\nlibrary(DHARMa)\nplot(simulateResiduals(mix2))\nqqnorm(residuals(mix2))\nqqline(residuals(mix2))\nhist(residuals(mix2))\n\nlibrary(emmeans)\nmedias_milho <- emmeans(mix2,\n                        ~hybrid | method,\n                        type= 'response'\n                        )\nmedias_milho <- emmeans(mix2,\n                        ~method | hybrid,\n                        type= 'response'\n                        )\nlibrary(multcomp)\ncld(medias_milho)\ncld(medias_milho2)\n```\n\n```{r}\nlibrary(ggplot2)\n```\n\n```{r}\nmix3 <- lmer(yield ~ hybrid *method + block + (1|block/hybrid), data = milho)\n\n(mix3)\ncheck_heteroscedasticity(mix3)\ncheck_normality(mix3)\n\nlibrary(DHARMa)\nplot(simulateResiduals(mix2))\nqqnorm(residuals(mix2))\nqqline(residuals(mix2))\nhist(residuals(mix2))\n\nlibrary(emmeans)\nmedias_milho <- emmeans(mix2,\n                        ~hybrid | method,\n                        type= 'response')\nmedias_milho <- emmeans(mix2,\n                        ~method | hybrid,\n                        type= 'response')\nlibrary(multcomp)\ncld(medias_milho)\ncld(medias_milho2)\n```\n\n# Importar datos de arroz\n\n```{r}\narroz<-gsheet2tbl('https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=401662555')\n\n```\n\nSi se inocula una semilla de arroz de 0 a 48%.\n\n```{r}\narroz |>\n  ggplot(aes(trat, nplants),theme_classic())+\n  geom_point(width = 0.1, alpha=0.2)+\n  facet_wrap(~exp)+\n  stat_summary(fun.data='mean_cl_boot', size=0.5, color = 'pink')+\n  geom_smooth(method = lm, se=FALSE)\n```\n\n```{r}\nexp1 <- arroz |>\n  filter(exp==1)\nexp1 |>\n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  ylim(0,100)+\n   geom_smooth(se=FALSE)\n```\n\n# Modelo de regresión linear simple:\n\n```{r}\nlm1 <- lm(nplants ~ trat,\n          data= exp1)\nsummary(lm1)\n```\n\nLa hipotesis nula dice que el coeficiente de regresión es igual a 0 (no tiene efecto). Para cada 1% de inóculo se reduce 0,24. Como el valor p fue mayor que 0,05, no rejecta H0, entonces no tiene efecto.\n\n### Experimento 2\n\n```{r}\nexp2 <- arroz |>\n  filter(exp==2)\nexp2 |>\n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  ylim(0,100)+\n   geom_smooth(se=FALSE)\n\nlm2 <- lm(nplants ~ trat,\n          data= exp2)\nsummary(lm2)\n```\n\n### Experimento 3\n\n```{r}\nexp3 <- arroz |>\n  filter(exp==3)\nexp3 |>\n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  ylim(0,100)+\n   geom_smooth(se=FALSE)\n\nlm3 <- lm(nplants ~ trat,\n          data= exp3)\nsummary(lm3)\nhist(residuals(lm3))\nhist(residuals(lm1))\n```\n\nAdjusted R-squared: 0,59 de y explica x en un 59%, el restante no se conoce.\n\n# GLM y AIC\n\n```{r}\n\nglm1 <- glm(nplants ~ trat, family = 'gaussian',\n            data = exp1)\nsummary(glm1)\nAIC(glm1)\n\nglm2 <- glm(nplants ~ trat, family = 'gaussian',\n            data = exp2)\nsummary(glm2)\nAIC(glm2)\n\nglm2b <- glm(nplants ~ trat, family = 'poisson',\n            data = exp2)\nsummary(glm2b)\nAIC(glm2b)\n\nglm3 <- glm(nplants ~ trat, family = 'gaussian',\n            data = exp3)\nsummary(glm3)\nAIC(glm3)\nglm3b <- glm(nplants ~ trat, family = 'poisson',\n            data = exp3)\nsummary(glm3b)\nAIC(glm3b)\n\n```\n\n```{r}\nlibrary(lme4)\nglm3 <- glmer(nplants ~ trat+ (trat| exp), family = 'gaussian',\n            data = arroz)\nsummary(glm3)\nAIC(glm3)\nglm3b <- glmer(nplants ~ trat+ (trat| exp), family = poisson(link = log),\n            data = arroz)\nsummary(glm3b)\nAIC(glm3b)\n```\n\n# Moho blanco en soya\n\n```{r}\nlibrary(r4pde)\n\nwm<- WhiteMoldSoybean\nwm |>\n  ggplot(aes(inc,yld))+\n  geom_point()+\n  facet_wrap(~study)+\n  theme_minimal()\n```\n\n```{r}\nmofo1<- lm(yld ~ inc,\n           data= wm)\nsummary(mofo1)\n```\n\n#Se tienen 3299 kg/h de produccion al haber incidencia cero\n\n#Se disminuye por 9.2 por cada porcentual aumentado.\n\n```{r}\nwm |> \n  ggplot(aes(inc, yld,\n             #group = factor(study)\n             color = factor(study)\n             ))+\n  geom_point()+\n  #facet_wrap(~ study)+\n  geom_smooth(method = \"lm\", se = F)\n  #theme_minimal()\n```\n\n```{r}\nlibrary(broom)\nmofo2<- wm%>%\n  group_by(study) |>\n  do(tidy(lm(.$yld ~ .$inc),conf.int=TRUE))\nmofo2\ndf <- mofo2 |> filter (term == '.$inc')\nmean (df$estimate)\n\nfit_all <- wm%>%\n  group_by(study) |> \n  do(broom::tidy(lm(.$yld ~ .$inc), conf.int=TRUE))\nfit_all\n\np3 <- fit_all |> \n  filter(term == \"(Intercept)\") |> \n  ggplot(aes(x = estimate))+\n  geom_histogram(bins = 8, color = \"white\", fill = \"gray50\")+\n  theme_r4pde()+\n  labs(x = \"Intercept\", y = \"Frequency\")\n\np4 <- fit_all |> \n  filter(term == \".$inc\") |> \n  ggplot(aes(x = estimate))+\n  geom_histogram(bins = 8, color = \"white\", fill = \"gray50\")+\n  theme_r4pde()+\n  labs(x = \"Slope\", y = \"Frequency\")\n\n\nlibrary(patchwork)\np3 | p4\n```\n\n```{r}\nlibrary(lme4)\nmofo3 <- lmer(yld~inc + (inc|study), data = wm,\n              REML= F)\nsummary(mofo3)\nAnova(mofo3)\nconfint(mofo3, method= 'Wald')\n```\n\nAqui se ve que el intercepto es de 3255 kg/h al haber 0 incidencia y cada porcentaje de incidencia aumentado, se pieden 17,23 kg/ha\n\n# Correlacion linear\n\nPodemos escoger modelos que pasan más próximos a todos los puntos, por lo que algunas regresiones estadísticas tienen diferentes modelos que pueden ser escogidos (PE regresiones no lineares).\n\nCrecimiento micelial / dosis cuál es la dosis que inhibe el 50% del crecimiento micelial, podemos hacer una comparación entre diferentes isolados fúngicos. Depende de la respuesta que nosotros modelamos.\n\nCorrelaciones: Es una asociacion entre 2 variables, también puede ser una disociación.\n\nEl incremento de una variable A y B, esta asociación en caso de que ambos datos aumenten, su relación es positiva.\n\nEntre más disaciociada(dispersa), esta se vuelve más cercana.\n\nCorrelación de pearson: 0 -1\n\nCuanto más disperson, menor el número de correlación.\n\nUna relación de causa efecto (uno aumenta y otro disminuye), como por ejemplo cuando una enfermedad aumenta y la productividad disminuye, puede tener una correlación negativa.\n\nLa regresión también se puede hacer también entre dos variables.\n\nR\\^2 = Al hacer la raíz de este resultado, siempre da menor a r. R2 es el coeficiente de determinación. Cuánto explica x a y.\n\nr Es la fuerza de asociación entre x e y\n\n```{r}\nimg <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=373270992\")\n\np1 <- img |> \n  ggplot(aes(Assess, ImageJ))+\n  geom_point()+\n  geom_smooth(method = \"lm\")\n\np2 <- img |> \n  ggplot(aes(Assess, LeafDoctor))+\n  geom_point()+\n  geom_smooth(method = \"lm\")\n\nimg |> \n  pivot_longer(3:5, names_to = \"method\",\n               values_to = \"value\") |> \n  ggplot(aes(method, value))+\n  geom_boxplot()\n```\n\n```{r}\np1 + p2\n```\n\n```{r}\nimg2 <- img |> \n  dplyr::select(Assess, LeafDoctor, ImageJ)\n\nlibrary(AgroR)\ncorgraph(img2)\n```\n\n```{r}\ncor.test(img$Assess, img$LeafDoctor)\n```\n\nEn este caso, la conclusión el assess es el programa estándar para que de una relación buena, si podemos sustituir el assess con otros datos, igualmente podemos recibir nuevas relaciones causa efecto por medio de respuestas/métodos diferentes.\n\n```{r}\ncor(img$Assess, img$LeafDoctor)\n```\n\n```{r}\nlibrary(corrplot)\ncor_img2 <- cor(img2)\ncorrplot(cor_img2, method = 'number', type = \"lower\")\n```\n\nNos da colores de los numeros dentro de la relacion y la matriz.\n\nAhora trabajemos con otro conjunto de datos.\n\n```{r}\ncor_img2 <- cor(img2)\ncorrplot(cor_img2, method = 'number', type = \"upper\")\n```\n\n```{r}\ncampo <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=866852711\")\n\ncampo2 <- campo |> \n  dplyr::select(DFC, FER, PROD)\n\ncorgraph(campo2)\n```\n\nUn problema que tenemos en campo, es que tenemos 2 enfermedades y queremos saber cual esta mas relacionada con la produccion.\n\nEn esta podemos ver que el DFC influye mas y donde hay DFC hay ferrugem pues estan correlacionadas.\n\n```{r}\ncor.test(campo$PROD, campo$DFC)\n```\n\n```{r}\ncor.test(campo$PROD, campo$FER)\n```\n\n```{r}\ncampo |>\n  ggplot(aes(DFC, PROD))+\n  geom_point()\n```\n\n# Modelo cuadrático de regresión linear.\n\nVamos a comparar los métodos linear y con el cuadrático.\n\n```{r}\nexp2 <- arroz |> \n  dplyr::filter(exp == 2)\n\nexp2 |> \n  ggplot(aes(trat, nplants))+\n  geom_point()+\n # stat_summary(fun.data = \"mean_cl_boot\", size = 0.5, color = \"black\",\n #              alpha = 0.5)+\n  ylim(0,100)+\n  geom_smooth(method = \"lm\",\n              se = FALSE,\n              formula = y ~poly(x,2),\n              color = \"black\")+\n  geom_smooth(method = \"lm\",\n              se = FALSE)\n```\n\n## Primer orden (Modelo linear)\n\n```{r}\nlm2 <- lm(nplants ~trat,\n          data = exp2)\nsummary(lm2)\n```\n\n```{r}\nhist(residuals(lm2))\nAIC(lm2)\n```\n\n```{r}\nexp2$trat2 <- exp2$trat^2\n\nlm3 <- lm(nplants ~trat + trat2,\n          data = exp2)\nsummary(lm3)\n```\n\n```{r}\nhist(residuals(lm3))\nAIC(lm3)\n```\n\nConclusion: EL r2 se explica mejor con la regresion cuadratica que con la linear.\n\nSegun AIC tambien el modelo cuadratico explica mejor la variacion (diferencia de 43% a 49%), entre menor es mejor,\n\nY= 66,3 - 1,77 x TRAT + 0,02 x TRAT\\^2\n\n```{r}\nwith(exp2, polynomial(trat, nplants, grau = 3))\n```\n\nSe puede ver los intervalos de confianza para cada punto, ajustando segun lo que calculo abajo, para dar un R\\^2.\n\ngrau 1 = linear.\n\nGrau 2= cuadratico, modelino curvilinear.\n\ngrau 3 = cubica, no tiene una explicacion biologica por lo que casi no se utiliza para esta aumentar entre dos tractos.\n\n# Datos de sensibilidad de fungicidas.\n\n```{r}\npyra <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=465348652\")\n\npyra2 <- pyra |>\n  group_by(code, state, dose) |> \n  summarise(mean_germination = mean(germination))\n\npyra2|> \n  ggplot(aes(dose, mean_germination))+\n  geom_point()+\n  facet_wrap(~code)\n```\n\n## Filtrar Isolado 186\n\n```{r}\nlibrary(drc)\n\nisolado186 <- pyra2 |> \n   filter(code == \"186\")\n\ndrc1 <- drm(mean_germination ~ dose, data = isolado186,\n            fct = W1.3())\n\nAIC(drc1)\n```\n\n```{r}\nplot(drc1)\n```\n\nSi la estimativa fuera mas alta, es mas sensible al fungicida.\n\nSi la estimativa (Estimate) fuera mas baja, es menos sensible al fungicida.\n\nEntre menor es el AIC, mejor.\n","srcMarkdownNoYaml":"\n\n# Análisi de Modelo Mixto, Correlación y Regresión Linear.\n\n## Pudrición de maíz.\n\nCada híbrido está dentro de cada bloque, el bloque se aleatorizó dentro de cada bloque.\n\nSe sortean los tratamientos del híbrido y los del método.\n\nSe sortean estos híbridos dentro de cada bloque.\n\nEs una parcela subdivida. ¿Cuándo es una parcela sub-sub dividida? Cuando hay 3 factores.\n\nNuestro modelo estadístico va a ser diferente, no es híbrido vs método+ bloque, se debe utilizar el valor b o utilizar un modelo mixto (mixtura entre un factor fijo y uno aleatorio). Ese es el modelo mixto, es un paquete diferente para estructurar esta situación (efecto aleatorio del híbrido).\n\n## Parcela subdividida\n\n```{r}\nlibrary(tidyverse)\nlibrary(readxl)\nlibrary(gsheet)\nlibrary(ggplot2)\nlibrary(DHARMa)\nlibrary(multcomp)\nlibrary(multcompView)\nlibrary(emmeans)\nmilho <- gsheet2tbl('https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=1345524759')\n```\n\n## Index\n\n```{r}\nmilho |>\n  ggplot(aes(method, index))+\n  geom_jitter(width = 0.1, alpha=0.2)+\n  facet_wrap(~hybrid)+\n  stat_summary(fun.data='mean_cl_boot', size=0.5, color = 'pink')\n```\n\n```{r}\nlibrary(lme4)\n\nmilho<-milho|>\n  mutate(block = as.factor(block))\nmix2<- lmer(index ~ hybrid*method + block+\n              (1|block/hybrid), data = milho)\n\nanova(mix2)\nlibrary(car)\n\n```\n\n1\\|block/hybrid indica la función (con efecto aleatorio). El resultado para la interacción entre híbrido y method es significativa.\n\n### Premisas\n\n```{r}\nlibrary(performance)\ncheck_normality(mix2)\ncheck_heteroscedasticity(mix2)\nsimulate_residuals(mix2)\n```\n\n```{r}\nplot(simulateResiduals(mix2))\nqqnorm(residuals(mix2))\nqqline(residuals(mix2))\nhist(residuals(mix2))\n```\n\n# Test de comparar medias\n\n```{r}\nmedias_milho <- emmeans(mix2,\n                        ~ hybrid | method,\n                        type = \"response\")\n\nmedias_milho2 <- emmeans(mix2,\n                         ~ method | hybrid,\n                         type = \"response\")\n\ncld(medias_milho, Letters = LETTERS)\ncld(medias_milho2, Letters = LETTERS)\n```\n\n```{r}\nlibrary(ggplot2)\nlibrary(Hmisc)\n\nindex <- milho |>\n  ggplot(aes(hybrid, index))+\n  geom_jitter(width = 0.05, color = \n                \"gray\")+\n  stat_summary(fun.data = \n                 \"mean_cl_boot\", size = 0.5, color = \n                 \"red\", alpha = 0.5)\nindex\n\nyield <- milho |>\n  ggplot(aes(hybrid, yield))+\n  geom_jitter(width = 0.05, color = \n                \"gray\")+\n  stat_summary(fun.data = \n                 \"mean_cl_boot\", size = 0.5, color = \n                 \"red\", alpha = 0.5)\nlibrary(ggplot2)\nlibrary(Hmisc)\n\nyield <- milho |>\n  ggplot(aes(hybrid, yield))+\n  geom_jitter(width = 0.05, color = \n                \"gray\")+\n  stat_summary(fun.data = \n                 \"mean_cl_boot\", size = 0.5, color = \n                 \"red\", alpha = 0.5)\n\n```\n\n![](images/clipboard-1362719507.png)\n\n```{r}\nlibrary(performance)\nmilho |> \n  ggplot(aes(method, index))+\n  geom_jitter(width =0.1, alpha = 0.2)+\n  facet_wrap(~ hybrid)+\n  stat_summary(fun.data = \"mean_cl_boot\", size \n               = 0.5, color = \"purple\")\n\nlibrary(DHARMa)\nplot(simulateResiduals(mix2))\nqqnorm(residuals(mix2))\nqqline(residuals(mix2))\nhist(residuals(mix2))\n\nlibrary(emmeans)\nmedias_milho <- emmeans(mix2,\n                        ~hybrid | method,\n                        type= 'response'\n                        )\nmedias_milho <- emmeans(mix2,\n                        ~method | hybrid,\n                        type= 'response'\n                        )\nlibrary(multcomp)\ncld(medias_milho)\ncld(medias_milho2)\n```\n\n```{r}\nlibrary(ggplot2)\n```\n\n```{r}\nmix3 <- lmer(yield ~ hybrid *method + block + (1|block/hybrid), data = milho)\n\n(mix3)\ncheck_heteroscedasticity(mix3)\ncheck_normality(mix3)\n\nlibrary(DHARMa)\nplot(simulateResiduals(mix2))\nqqnorm(residuals(mix2))\nqqline(residuals(mix2))\nhist(residuals(mix2))\n\nlibrary(emmeans)\nmedias_milho <- emmeans(mix2,\n                        ~hybrid | method,\n                        type= 'response')\nmedias_milho <- emmeans(mix2,\n                        ~method | hybrid,\n                        type= 'response')\nlibrary(multcomp)\ncld(medias_milho)\ncld(medias_milho2)\n```\n\n# Importar datos de arroz\n\n```{r}\narroz<-gsheet2tbl('https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=401662555')\n\n```\n\nSi se inocula una semilla de arroz de 0 a 48%.\n\n```{r}\narroz |>\n  ggplot(aes(trat, nplants),theme_classic())+\n  geom_point(width = 0.1, alpha=0.2)+\n  facet_wrap(~exp)+\n  stat_summary(fun.data='mean_cl_boot', size=0.5, color = 'pink')+\n  geom_smooth(method = lm, se=FALSE)\n```\n\n```{r}\nexp1 <- arroz |>\n  filter(exp==1)\nexp1 |>\n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  ylim(0,100)+\n   geom_smooth(se=FALSE)\n```\n\n# Modelo de regresión linear simple:\n\n```{r}\nlm1 <- lm(nplants ~ trat,\n          data= exp1)\nsummary(lm1)\n```\n\nLa hipotesis nula dice que el coeficiente de regresión es igual a 0 (no tiene efecto). Para cada 1% de inóculo se reduce 0,24. Como el valor p fue mayor que 0,05, no rejecta H0, entonces no tiene efecto.\n\n### Experimento 2\n\n```{r}\nexp2 <- arroz |>\n  filter(exp==2)\nexp2 |>\n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  ylim(0,100)+\n   geom_smooth(se=FALSE)\n\nlm2 <- lm(nplants ~ trat,\n          data= exp2)\nsummary(lm2)\n```\n\n### Experimento 3\n\n```{r}\nexp3 <- arroz |>\n  filter(exp==3)\nexp3 |>\n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  ylim(0,100)+\n   geom_smooth(se=FALSE)\n\nlm3 <- lm(nplants ~ trat,\n          data= exp3)\nsummary(lm3)\nhist(residuals(lm3))\nhist(residuals(lm1))\n```\n\nAdjusted R-squared: 0,59 de y explica x en un 59%, el restante no se conoce.\n\n# GLM y AIC\n\n```{r}\n\nglm1 <- glm(nplants ~ trat, family = 'gaussian',\n            data = exp1)\nsummary(glm1)\nAIC(glm1)\n\nglm2 <- glm(nplants ~ trat, family = 'gaussian',\n            data = exp2)\nsummary(glm2)\nAIC(glm2)\n\nglm2b <- glm(nplants ~ trat, family = 'poisson',\n            data = exp2)\nsummary(glm2b)\nAIC(glm2b)\n\nglm3 <- glm(nplants ~ trat, family = 'gaussian',\n            data = exp3)\nsummary(glm3)\nAIC(glm3)\nglm3b <- glm(nplants ~ trat, family = 'poisson',\n            data = exp3)\nsummary(glm3b)\nAIC(glm3b)\n\n```\n\n```{r}\nlibrary(lme4)\nglm3 <- glmer(nplants ~ trat+ (trat| exp), family = 'gaussian',\n            data = arroz)\nsummary(glm3)\nAIC(glm3)\nglm3b <- glmer(nplants ~ trat+ (trat| exp), family = poisson(link = log),\n            data = arroz)\nsummary(glm3b)\nAIC(glm3b)\n```\n\n# Moho blanco en soya\n\n```{r}\nlibrary(r4pde)\n\nwm<- WhiteMoldSoybean\nwm |>\n  ggplot(aes(inc,yld))+\n  geom_point()+\n  facet_wrap(~study)+\n  theme_minimal()\n```\n\n```{r}\nmofo1<- lm(yld ~ inc,\n           data= wm)\nsummary(mofo1)\n```\n\n#Se tienen 3299 kg/h de produccion al haber incidencia cero\n\n#Se disminuye por 9.2 por cada porcentual aumentado.\n\n```{r}\nwm |> \n  ggplot(aes(inc, yld,\n             #group = factor(study)\n             color = factor(study)\n             ))+\n  geom_point()+\n  #facet_wrap(~ study)+\n  geom_smooth(method = \"lm\", se = F)\n  #theme_minimal()\n```\n\n```{r}\nlibrary(broom)\nmofo2<- wm%>%\n  group_by(study) |>\n  do(tidy(lm(.$yld ~ .$inc),conf.int=TRUE))\nmofo2\ndf <- mofo2 |> filter (term == '.$inc')\nmean (df$estimate)\n\nfit_all <- wm%>%\n  group_by(study) |> \n  do(broom::tidy(lm(.$yld ~ .$inc), conf.int=TRUE))\nfit_all\n\np3 <- fit_all |> \n  filter(term == \"(Intercept)\") |> \n  ggplot(aes(x = estimate))+\n  geom_histogram(bins = 8, color = \"white\", fill = \"gray50\")+\n  theme_r4pde()+\n  labs(x = \"Intercept\", y = \"Frequency\")\n\np4 <- fit_all |> \n  filter(term == \".$inc\") |> \n  ggplot(aes(x = estimate))+\n  geom_histogram(bins = 8, color = \"white\", fill = \"gray50\")+\n  theme_r4pde()+\n  labs(x = \"Slope\", y = \"Frequency\")\n\n\nlibrary(patchwork)\np3 | p4\n```\n\n```{r}\nlibrary(lme4)\nmofo3 <- lmer(yld~inc + (inc|study), data = wm,\n              REML= F)\nsummary(mofo3)\nAnova(mofo3)\nconfint(mofo3, method= 'Wald')\n```\n\nAqui se ve que el intercepto es de 3255 kg/h al haber 0 incidencia y cada porcentaje de incidencia aumentado, se pieden 17,23 kg/ha\n\n# Correlacion linear\n\nPodemos escoger modelos que pasan más próximos a todos los puntos, por lo que algunas regresiones estadísticas tienen diferentes modelos que pueden ser escogidos (PE regresiones no lineares).\n\nCrecimiento micelial / dosis cuál es la dosis que inhibe el 50% del crecimiento micelial, podemos hacer una comparación entre diferentes isolados fúngicos. Depende de la respuesta que nosotros modelamos.\n\nCorrelaciones: Es una asociacion entre 2 variables, también puede ser una disociación.\n\nEl incremento de una variable A y B, esta asociación en caso de que ambos datos aumenten, su relación es positiva.\n\nEntre más disaciociada(dispersa), esta se vuelve más cercana.\n\nCorrelación de pearson: 0 -1\n\nCuanto más disperson, menor el número de correlación.\n\nUna relación de causa efecto (uno aumenta y otro disminuye), como por ejemplo cuando una enfermedad aumenta y la productividad disminuye, puede tener una correlación negativa.\n\nLa regresión también se puede hacer también entre dos variables.\n\nR\\^2 = Al hacer la raíz de este resultado, siempre da menor a r. R2 es el coeficiente de determinación. Cuánto explica x a y.\n\nr Es la fuerza de asociación entre x e y\n\n```{r}\nimg <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=373270992\")\n\np1 <- img |> \n  ggplot(aes(Assess, ImageJ))+\n  geom_point()+\n  geom_smooth(method = \"lm\")\n\np2 <- img |> \n  ggplot(aes(Assess, LeafDoctor))+\n  geom_point()+\n  geom_smooth(method = \"lm\")\n\nimg |> \n  pivot_longer(3:5, names_to = \"method\",\n               values_to = \"value\") |> \n  ggplot(aes(method, value))+\n  geom_boxplot()\n```\n\n```{r}\np1 + p2\n```\n\n```{r}\nimg2 <- img |> \n  dplyr::select(Assess, LeafDoctor, ImageJ)\n\nlibrary(AgroR)\ncorgraph(img2)\n```\n\n```{r}\ncor.test(img$Assess, img$LeafDoctor)\n```\n\nEn este caso, la conclusión el assess es el programa estándar para que de una relación buena, si podemos sustituir el assess con otros datos, igualmente podemos recibir nuevas relaciones causa efecto por medio de respuestas/métodos diferentes.\n\n```{r}\ncor(img$Assess, img$LeafDoctor)\n```\n\n```{r}\nlibrary(corrplot)\ncor_img2 <- cor(img2)\ncorrplot(cor_img2, method = 'number', type = \"lower\")\n```\n\nNos da colores de los numeros dentro de la relacion y la matriz.\n\nAhora trabajemos con otro conjunto de datos.\n\n```{r}\ncor_img2 <- cor(img2)\ncorrplot(cor_img2, method = 'number', type = \"upper\")\n```\n\n```{r}\ncampo <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=866852711\")\n\ncampo2 <- campo |> \n  dplyr::select(DFC, FER, PROD)\n\ncorgraph(campo2)\n```\n\nUn problema que tenemos en campo, es que tenemos 2 enfermedades y queremos saber cual esta mas relacionada con la produccion.\n\nEn esta podemos ver que el DFC influye mas y donde hay DFC hay ferrugem pues estan correlacionadas.\n\n```{r}\ncor.test(campo$PROD, campo$DFC)\n```\n\n```{r}\ncor.test(campo$PROD, campo$FER)\n```\n\n```{r}\ncampo |>\n  ggplot(aes(DFC, PROD))+\n  geom_point()\n```\n\n# Modelo cuadrático de regresión linear.\n\nVamos a comparar los métodos linear y con el cuadrático.\n\n```{r}\nexp2 <- arroz |> \n  dplyr::filter(exp == 2)\n\nexp2 |> \n  ggplot(aes(trat, nplants))+\n  geom_point()+\n # stat_summary(fun.data = \"mean_cl_boot\", size = 0.5, color = \"black\",\n #              alpha = 0.5)+\n  ylim(0,100)+\n  geom_smooth(method = \"lm\",\n              se = FALSE,\n              formula = y ~poly(x,2),\n              color = \"black\")+\n  geom_smooth(method = \"lm\",\n              se = FALSE)\n```\n\n## Primer orden (Modelo linear)\n\n```{r}\nlm2 <- lm(nplants ~trat,\n          data = exp2)\nsummary(lm2)\n```\n\n```{r}\nhist(residuals(lm2))\nAIC(lm2)\n```\n\n```{r}\nexp2$trat2 <- exp2$trat^2\n\nlm3 <- lm(nplants ~trat + trat2,\n          data = exp2)\nsummary(lm3)\n```\n\n```{r}\nhist(residuals(lm3))\nAIC(lm3)\n```\n\nConclusion: EL r2 se explica mejor con la regresion cuadratica que con la linear.\n\nSegun AIC tambien el modelo cuadratico explica mejor la variacion (diferencia de 43% a 49%), entre menor es mejor,\n\nY= 66,3 - 1,77 x TRAT + 0,02 x TRAT\\^2\n\n```{r}\nwith(exp2, polynomial(trat, nplants, grau = 3))\n```\n\nSe puede ver los intervalos de confianza para cada punto, ajustando segun lo que calculo abajo, para dar un R\\^2.\n\ngrau 1 = linear.\n\nGrau 2= cuadratico, modelino curvilinear.\n\ngrau 3 = cubica, no tiene una explicacion biologica por lo que casi no se utiliza para esta aumentar entre dos tractos.\n\n# Datos de sensibilidad de fungicidas.\n\n```{r}\npyra <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=465348652\")\n\npyra2 <- pyra |>\n  group_by(code, state, dose) |> \n  summarise(mean_germination = mean(germination))\n\npyra2|> \n  ggplot(aes(dose, mean_germination))+\n  geom_point()+\n  facet_wrap(~code)\n```\n\n## Filtrar Isolado 186\n\n```{r}\nlibrary(drc)\n\nisolado186 <- pyra2 |> \n   filter(code == \"186\")\n\ndrc1 <- drm(mean_germination ~ dose, data = isolado186,\n            fct = W1.3())\n\nAIC(drc1)\n```\n\n```{r}\nplot(drc1)\n```\n\nSi la estimativa fuera mas alta, es mas sensible al fungicida.\n\nSi la estimativa (Estimate) fuera mas baja, es menos sensible al fungicida.\n\nEntre menor es el AIC, mejor.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":true,"freeze":"auto","echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"aula9.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.555","editor":"visual","fontsize":"1.1em","theme":{"light":"flatly","dark":"darkly"},"title":"aula9"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}