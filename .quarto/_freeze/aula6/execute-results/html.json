{
  "hash": "c28f79f5e7a8571f3e498254f091a84e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Test T y Anova\"\nformat: html\neditor: visual\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gsheet)\nmg<- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=983033137\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nmg |>\n  ggplot(aes(trat, comp))+\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n# Parametrico\n\nEl test T tiene Paired (TRUE) y Non Paired (FALSE) Es cuando tengo variables dependientes o independientes.\n\nLuego tenemos variancias Var.test, si este da menor a 0,05 tenemos Var.Equal = False.\n\n# No parametrico\n\nWillcox.test (Paired = True False) Este solo se usa para variables dependientes.\n\nMannWhitney es para variables independientes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmg2<-mg |>\n  pivot_wider (names_from = trat,\n               values_from = comp)\nmg2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 3\n     rep   Mg2 control\n   <dbl> <dbl>   <dbl>\n 1     1   9      13.7\n 2     2  12.5    15.9\n 3     3  10      15.7\n 4     4   8      14.2\n 5     5  13.2    15.9\n 6     6  11      16.5\n 7     7  10.8    18  \n 8     8   9.5    14.4\n 9     9  10.8    16.4\n10    10  10.4    16  \n```\n\n\n:::\n\n```{.r .cell-code}\nteste1<-t.test(mg2$Mg2, mg2$control,\n       var.equal=TRUE)\nteste1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tTwo Sample t-test\n\ndata:  mg2$Mg2 and mg2$control\nt = -8.1549, df = 18, p-value = 1.863e-07\nalternative hypothesis: true difference in means is not equal to 0\n95 percent confidence interval:\n -6.486839 -3.829161\nsample estimates:\nmean of x mean of y \n   10.520    15.678 \n```\n\n\n:::\n\n```{.r .cell-code}\n#Puede ser FALSE tambien, esto se cambia para que las varianzas sean heterogeneas, esto depende del test de varianzas\n\n# hipotesis nula es normalidad en el shapiro.\nhist(mg2$control)\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\nhist(mg2$Mg2)\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n\n```{.r .cell-code}\nwilcox.test(mg2$Mg2, mg2$control,\n       paired= FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWilcoxon rank sum test with continuity correction\n\ndata:  mg2$Mg2 and mg2$control\nW = 0, p-value = 0.0001817\nalternative hypothesis: true location shift is not equal to 0\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshapiro.test(mg2$control)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  mg2$control\nW = 0.93886, p-value = 0.5404\n```\n\n\n:::\n\n```{.r .cell-code}\nvar.test(mg2$control, mg2$Mg2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tF test to compare two variances\n\ndata:  mg2$control and mg2$Mg2\nF = 0.67654, num df = 9, denom df = 9, p-value = 0.5698\nalternative hypothesis: true ratio of variances is not equal to 1\n95 percent confidence interval:\n 0.1680428 2.7237436\nsample estimates:\nratio of variances \n         0.6765394 \n```\n\n\n:::\n\n```{.r .cell-code}\n#Todo esto se usa para revisar si la Hipotesis nula de la propuesta inicial puede ser rechazada. Este es un test parametrico al haber normalidad.\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nqqnorm(mg2$control)\nqqline(mg2$control)\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nvar.test(mg2$control, mg2$Mg2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tF test to compare two variances\n\ndata:  mg2$control and mg2$Mg2\nF = 0.67654, num df = 9, denom df = 9, p-value = 0.5698\nalternative hypothesis: true ratio of variances is not equal to 1\n95 percent confidence interval:\n 0.1680428 2.7237436\nsample estimates:\nratio of variances \n         0.6765394 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(report)\nreport(teste1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEffect sizes were labelled following Cohen's (1988) recommendations.\n\nThe Two Sample t-test testing the difference between mg2$Mg2 and mg2$control\n(mean of x = 10.52, mean of y = 15.68) suggests that the effect is negative,\nstatistically significant, and large (difference = -5.16, 95% CI [-6.49,\n-3.83], t(18) = -8.15, p < .001; Cohen's d = -3.65, 95% CI [-5.10, -2.16])\n```\n\n\n:::\n:::\n\n\n# Dos grupos dependientes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nescala<- gsheet2tbl('https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=1729131173')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nescala |>\n  ggplot(aes(assessment, acuracia))+\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nescala2<-escala |>\n  select(assessment, rater, acuracia)|>\n  pivot_wider(names_from = assessment,\n               values_from = acuracia)\nescala2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 3\n   rater Unaided Aided1\n   <chr>   <dbl>  <dbl>\n 1 A        0.81   0.91\n 2 B        0.72   0.91\n 3 C        0.4    0.91\n 4 D        0.82   0.96\n 5 E        0.75   0.96\n 6 F        0.45   0.9 \n 7 G        0.81   0.85\n 8 H        0.78   0.88\n 9 I        0.78   0.95\n10 J        0.5    0.94\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshapiro.test(escala2$Unaided)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  escala2$Unaided\nW = 0.7748, p-value = 0.007155\n```\n\n\n:::\n\n```{.r .cell-code}\nshapiro.test(escala2$Aided1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  escala2$Aided1\nW = 0.92852, p-value = 0.4335\n```\n\n\n:::\n\n```{.r .cell-code}\n#Rechaza las normalidades\nA<-var.test(escala2$Unaided, escala2$Aided1,\n         paired= TRUE,\n         var.equal = FALSE)\nA\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tF test to compare two variances\n\ndata:  escala2$Unaided and escala2$Aided1\nF = 20.978, num df = 9, denom df = 9, p-value = 0.000106\nalternative hypothesis: true ratio of variances is not equal to 1\n95 percent confidence interval:\n  5.210754 84.459185\nsample estimates:\nratio of variances \n          20.97847 \n```\n\n\n:::\n:::\n\n\n# Test no paramétrico\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwilcox.test(escala2$Aided1,\n            escala2$Unaided,\n            paired = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWilcoxon signed rank test with continuity correction\n\ndata:  escala2$Aided1 and escala2$Unaided\nV = 55, p-value = 0.005889\nalternative hypothesis: true location shift is not equal to 0\n```\n\n\n:::\n\n```{.r .cell-code}\n#Al ser menor de 0,05 se rechaza la hipotesis nula.\n```\n:::\n\n\n# Analisis exploratorio: 3 o mas grupos\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmicelial<-gsheet2tbl('https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=959387827')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmicelial |>\n  ggplot(aes(especie,tcm))+\n  geom_jitter(width = 0.05)\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#Que vamos a testear? Ver si una de las variables es diferente entre ellas.\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nml <-lm(tcm ~ especie, data = micelial) #En especie se puede colocar -1 para ver el summary mejor\nanova (ml)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: tcm\n          Df  Sum Sq Mean Sq F value    Pr(>F)    \nespecie    4 1.46958 0.36739  19.629 2.028e-07 ***\nResiduals 25 0.46792 0.01872                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(ml)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = tcm ~ especie, data = micelial)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.23667 -0.09667  0.01583  0.08833  0.28333 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  1.57167    0.05585  28.140  < 2e-16 ***\nespecieFaus -0.33500    0.07899  -4.241 0.000266 ***\nespecieFcor -0.25000    0.07899  -3.165 0.004047 ** \nespecieFgra -0.66000    0.07899  -8.356 1.05e-08 ***\nespecieFmer -0.14500    0.07899  -1.836 0.078317 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1368 on 25 degrees of freedom\nMultiple R-squared:  0.7585,\tAdjusted R-squared:  0.7199 \nF-statistic: 19.63 on 4 and 25 DF,  p-value: 2.028e-07\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary (emmeans)\nmedias1<-emmeans(ml,~ especie)\nlibrary(multcomp)\nlibrary(multcompView)\ncld(medias1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n especie emmean     SE df lower.CL upper.CL .group\n Fgra     0.912 0.0559 25    0.797     1.03  1    \n Faus     1.237 0.0559 25    1.122     1.35   2   \n Fcor     1.322 0.0559 25    1.207     1.44   2   \n Fmer     1.427 0.0559 25    1.312     1.54   23  \n Fasi     1.572 0.0559 25    1.457     1.69    3  \n\nConfidence level used: 0.95 \nP value adjustment: tukey method for comparing a family of 5 estimates \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n\n```{.r .cell-code}\n#Para revisar los modelos tan complejos, da una simulacion de los residuos.\nlibrary(performance)\ncheck_normality(ml)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nOK: residuals appear as normally distributed (p = 0.878).\n```\n\n\n:::\n\n```{.r .cell-code}\ncheck_heteroscedasticity(ml)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nOK: Error variance appears to be homoscedastic (p = 0.880).\n```\n\n\n:::\n\n```{.r .cell-code}\ncheck_model(ml)\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(DHARMa)\nplot(simulateResiduals(ml))\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n# Base de datos: Insecticida.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggthemes)\ntheme_base\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nfunction (base_size = 16, base_family = \"\") \n{\n    theme_foundation() + theme(line = element_line(colour = \"black\", \n        lineend = \"round\", linetype = \"solid\"), rect = element_rect(fill = \"white\", \n        colour = \"black\", linetype = \"solid\"), text = element_text(colour = \"black\", \n        face = \"plain\", family = base_family, size = base_size, \n        vjust = 0.5, hjust = 0.5, lineheight = 1), panel.grid = element_blank(), \n        strip.background = element_rect(colour = NA), legend.key = element_rect(colour = NA), \n        title = element_text(size = rel(1)), plot.title = element_text(size = rel(1.2), \n            face = \"bold\"), strip.text = element_text(), axis.ticks.length = unit(0.5, \n            \"lines\"))\n}\n<bytecode: 0x00000213d2c087a0>\n<environment: namespace:ggthemes>\n```\n\n\n:::\n\n```{.r .cell-code}\ninsecticida<- InsectSprays\n\ninsecticida |>\n  count(spray)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  spray  n\n1     A 12\n2     B 12\n3     C 12\n4     D 12\n5     E 12\n6     F 12\n```\n\n\n:::\n\n```{.r .cell-code}\n#n significa cuantas veces se probo cada insecticida.\n#Se ve 1 factor solo con 6 niveles.\ninsecticida |>\n  ggplot(aes(spray,count))+\n           geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\nSe genero un boxplot para ver que sucede dentro de los datos de una manera mas facil. Primero se deben trabajar con los residuos de anova, para ajustar la anova para poder realizar todos los test que necesitamos.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1<- lm(count ~ spray,\n         data = insecticida)\nsummary(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = count ~ spray, data = insecticida)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-8.333 -1.958 -0.500  1.667  9.333 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  14.5000     1.1322  12.807  < 2e-16 ***\nsprayB        0.8333     1.6011   0.520    0.604    \nsprayC      -12.4167     1.6011  -7.755 7.27e-11 ***\nsprayD       -9.5833     1.6011  -5.985 9.82e-08 ***\nsprayE      -11.0000     1.6011  -6.870 2.75e-09 ***\nsprayF        2.1667     1.6011   1.353    0.181    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 3.922 on 66 degrees of freedom\nMultiple R-squared:  0.7244,\tAdjusted R-squared:  0.7036 \nF-statistic:  34.7 on 5 and 66 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n\n```{.r .cell-code}\nanova(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: count\n          Df Sum Sq Mean Sq F value    Pr(>F)    \nspray      5 2668.8  533.77  34.702 < 2.2e-16 ***\nResiduals 66 1015.2   15.38                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nml$residuals\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n          1           2           3           4           5           6 \n-0.07166667  0.01833333 -0.05166667 -0.05166667  0.02833333  0.12833333 \n          7           8           9          10          11          12 \n 0.28333333  0.01333333  0.03333333  0.06333333 -0.15666667 -0.23666667 \n         13          14          15          16          17          18 \n-0.10166667 -0.08166667 -0.12166667  0.06833333  0.10833333  0.12833333 \n         19          20          21          22          23          24 \n-0.03166667  0.06833333 -0.20166667  0.08833333 -0.01166667  0.08833333 \n         25          26          27          28          29          30 \n 0.12333333  0.19333333  0.14333333 -0.11666667 -0.14666667 -0.19666667 \n```\n\n\n:::\n\n```{.r .cell-code}\nhist(ml$residuals)\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n\n```{.r .cell-code}\nqqnorm(ml$residuals)\nqqline(ml$residuals)\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-19-2.png){width=672}\n:::\n\n```{.r .cell-code}\nshapiro.test(ml$residuals)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  ml$residuals\nW = 0.9821, p-value = 0.8782\n```\n\n\n:::\n\n```{.r .cell-code}\nbartlett.test(count ~ spray,\n              data = insecticida)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tBartlett test of homogeneity of variances\n\ndata:  count by spray\nBartlett's K-squared = 25.96, df = 5, p-value = 9.085e-05\n```\n\n\n:::\n\n```{.r .cell-code}\n#Es mas importante que las varianzas no sean heterogeneas que la ausencia de normalidad.\n#En el caso de esta base de datos, la varianza es heterogenea y tampoco tiene normalidad. podemos ver esto directamente en el siguiente codigo\nlibrary (emmeans)\nm1_medias<-emmeans(m1, ~ spray)\nm1_medias\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n spray emmean   SE df lower.CL upper.CL\n A      14.50 1.13 66   12.240    16.76\n B      15.33 1.13 66   13.073    17.59\n C       2.08 1.13 66   -0.177     4.34\n D       4.92 1.13 66    2.656     7.18\n E       3.50 1.13 66    1.240     5.76\n F      16.67 1.13 66   14.406    18.93\n\nConfidence level used: 0.95 \n```\n\n\n:::\n\n```{.r .cell-code}\nplot(m1_medias)\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-19-3.png){width=672}\n:::\n\n```{.r .cell-code}\nlibrary(multcomp)\nlibrary(multcompView)\ncld(m1_medias)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n spray emmean   SE df lower.CL upper.CL .group\n C       2.08 1.13 66   -0.177     4.34  1    \n E       3.50 1.13 66    1.240     5.76  1    \n D       4.92 1.13 66    2.656     7.18  1    \n A      14.50 1.13 66   12.240    16.76   2   \n B      15.33 1.13 66   13.073    17.59   2   \n F      16.67 1.13 66   14.406    18.93   2   \n\nConfidence level used: 0.95 \nP value adjustment: tukey method for comparing a family of 6 estimates \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(performance)\ncheck_normality(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nWarning: Non-normality of residuals detected (p = 0.022).\n```\n\n\n:::\n\n```{.r .cell-code}\ncheck_heteroscedasticity(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nWarning: Heteroscedasticity (non-constant error variance) detected (p < .001).\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(DHARMa)\nplot(simulateResiduals(m1))\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-19-4.png){width=672}\n:::\n\n```{.r .cell-code}\n#Se puede notar que no hay problema con la normalidad pero si con la varianza\n```\n:::\n\n\n## Alternativa 1 - Transformacion.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm2<- lm(count ~ spray,\n         data = insecticida)\ninsecticida2 <- insecticida |>\n  mutate(count2= sqrt(count))\ninsecticida2 |>\n  ggplot(aes(spray,count2))+\n           geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n\n```{.r .cell-code}\nm2<- lm(count2 ~ spray,\n         data = insecticida2)\nsummary(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = count2 ~ spray, data = insecticida2)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-1.24486 -0.39970 -0.01902  0.42661  1.40089 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)   3.7607     0.1814  20.733  < 2e-16 ***\nsprayB        0.1160     0.2565   0.452    0.653    \nsprayC       -2.5158     0.2565  -9.807 1.64e-14 ***\nsprayD       -1.5963     0.2565  -6.223 3.80e-08 ***\nsprayE       -1.9512     0.2565  -7.606 1.34e-10 ***\nsprayF        0.2579     0.2565   1.006    0.318    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.6283 on 66 degrees of freedom\nMultiple R-squared:  0.7724,\tAdjusted R-squared:  0.7552 \nF-statistic:  44.8 on 5 and 66 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n\n```{.r .cell-code}\nanova(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: count2\n          Df Sum Sq Mean Sq F value    Pr(>F)    \nspray      5 88.438 17.6876  44.799 < 2.2e-16 ***\nResiduals 66 26.058  0.3948                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nm2$residuals\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n          1           2           3           4           5           6 \n-0.59840073 -1.11492708  0.71145756 -0.01902101 -0.01902101 -0.29657678 \n          7           8           9          10          11          12 \n-0.59840073  1.03515313  0.36242723  0.71145756 -0.01902101 -0.15512712 \n         13          14          15          16          17          18 \n-0.56000661  0.24647423  0.70594430 -0.56000661  0.12336860 -0.13497401 \n         19          20          21          22          23          24 \n 0.24647423  0.24647423  0.48226755  0.70594430 -1.23088009 -0.27108012 \n         25          26          27          28          29          30 \n-1.24485667 -0.24485667  1.40089464  0.16935689  0.48719414 -0.24485667 \n         31          32          33          34          35          36 \n 0.16935689 -0.24485667  0.48719414 -1.24485667 -0.24485667  0.75514333 \n         37          38          39          40          41          42 \n-0.43230306  0.07171411  1.29974775  0.28513587 -0.16435387 -0.43230306 \n         43          44          45          46          47          48 \n 0.07171411  0.07171411  0.07171411  0.07171411 -0.75014031 -0.16435387 \n         49          50          51          52          53          54 \n-0.07741021  0.42660696 -0.07741021  0.42660696 -0.07741021  0.64002872 \n         55          56          57          58          59          60 \n-0.80946102 -0.80946102 -0.07741021 -0.39524746  0.64002872  0.19053898 \n         61          62          63          64          65          66 \n-0.70199237 -1.01861716 -0.14563382  0.67179860 -0.14563382 -0.01861716 \n         67          68          69          70          71          72 \n-0.41306589 -0.85633950  1.08040235  1.08040235  0.88036232 -0.41306589 \n```\n\n\n:::\n\n```{.r .cell-code}\nhist(m2$residuals)\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-20-2.png){width=672}\n:::\n\n```{.r .cell-code}\nqqnorm(m2$residuals)\nqqline(m2$residuals)\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-20-3.png){width=672}\n:::\n\n```{.r .cell-code}\nshapiro.test(m2$residuals)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  m2$residuals\nW = 0.98721, p-value = 0.6814\n```\n\n\n:::\n\n```{.r .cell-code}\nbartlett.test(count2 ~ spray,\n              data = insecticida2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tBartlett test of homogeneity of variances\n\ndata:  count2 by spray\nBartlett's K-squared = 3.7525, df = 5, p-value = 0.5856\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary (emmeans)\nm2_medias<-emmeans(m2, ~ spray)\nm2_medias\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n spray emmean    SE df lower.CL upper.CL\n A       3.76 0.181 66    3.399     4.12\n B       3.88 0.181 66    3.514     4.24\n C       1.24 0.181 66    0.883     1.61\n D       2.16 0.181 66    1.802     2.53\n E       1.81 0.181 66    1.447     2.17\n F       4.02 0.181 66    3.656     4.38\n\nConfidence level used: 0.95 \n```\n\n\n:::\n\n```{.r .cell-code}\nplot(m2_medias)\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-20-4.png){width=672}\n:::\n\n```{.r .cell-code}\nlibrary(multcomp)\nlibrary(multcompView)\ncld(m2_medias)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n spray emmean    SE df lower.CL upper.CL .group\n C       1.24 0.181 66    0.883     1.61  1    \n E       1.81 0.181 66    1.447     2.17  12   \n D       2.16 0.181 66    1.802     2.53   2   \n A       3.76 0.181 66    3.399     4.12    3  \n B       3.88 0.181 66    3.514     4.24    3  \n F       4.02 0.181 66    3.656     4.38    3  \n\nConfidence level used: 0.95 \nP value adjustment: tukey method for comparing a family of 6 estimates \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(performance)\ncheck_normality(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nOK: residuals appear as normally distributed (p = 0.681).\n```\n\n\n:::\n\n```{.r .cell-code}\ncheck_heteroscedasticity(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nOK: Error variance appears to be homoscedastic (p = 0.854).\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(DHARMa)\nplot(simulateResiduals(m2))\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-20-5.png){width=672}\n:::\n\n```{.r .cell-code}\n#El test de anova demuestra que por lo menos uno de los grupos demuestra diferencia de los otros.\n\npwpm(m2_medias)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       A      B      C      D      E      F\nA [3.76] 0.9975 <.0001 <.0001 <.0001 0.9145\nB -0.116 [3.88] <.0001 <.0001 <.0001 0.9936\nC  2.516  2.632 [1.24] 0.0081 0.2513 <.0001\nD  1.596  1.712 -0.919 [2.16] 0.7366 <.0001\nE  1.951  2.067 -0.565  0.355 [1.81] <.0001\nF -0.258 -0.142 -2.774 -1.854 -2.209 [4.02]\n\nRow and column labels: spray\nUpper triangle: P values   adjust = \"tukey\"\nDiagonal: [Estimates] (emmean) \nLower triangle: Comparisons (estimate)   earlier vs. later\n```\n\n\n:::\n\n```{.r .cell-code}\npwpp(m2_medias)\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-20-6.png){width=672}\n:::\n\n```{.r .cell-code}\npairs(m2_medias)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n contrast estimate    SE df t.ratio p.value\n A - B      -0.116 0.257 66  -0.452  0.9975\n A - C       2.516 0.257 66   9.807  <.0001\n A - D       1.596 0.257 66   6.223  <.0001\n A - E       1.951 0.257 66   7.606  <.0001\n A - F      -0.258 0.257 66  -1.006  0.9145\n B - C       2.632 0.257 66  10.259  <.0001\n B - D       1.712 0.257 66   6.675  <.0001\n B - E       2.067 0.257 66   8.058  <.0001\n B - F      -0.142 0.257 66  -0.554  0.9936\n C - D      -0.919 0.257 66  -3.584  0.0081\n C - E      -0.565 0.257 66  -2.201  0.2513\n C - F      -2.774 0.257 66 -10.813  <.0001\n D - E       0.355 0.257 66   1.383  0.7366\n D - F      -1.854 0.257 66  -7.229  <.0001\n E - F      -2.209 0.257 66  -8.612  <.0001\n\nP value adjustment: tukey method for comparing a family of 6 estimates \n```\n\n\n:::\n\n```{.r .cell-code}\n#Transformación de box-cox y(lambda)= (x^lambda-1)/lambda\nlibrary (MASS)\n\nb<-boxcox(lm(insecticida$count+0.1~1))\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-20-7.png){width=672}\n:::\n\n```{.r .cell-code}\n#calcular lambda\nlambda <- b$x[which.max(b$y)]\nlambda\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.4242424\n```\n\n\n:::\n\n```{.r .cell-code}\n#hacer la formula\ninsecticida$count3 <- (insecticida$count ^ lambda -1) /lambda\ninsecticida$count3\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1]  3.903635  3.024469  6.043993  4.864268  4.864268  4.407118  3.903635\n [8]  6.557185  5.484274  6.043993  4.864268  4.640760  4.161975  5.484274\n[15]  6.219699  4.161975  5.285168  4.864268  5.484274  5.484274  5.863153\n[22]  6.219699  3.024469  4.640760 -2.357143  0.000000  3.024469  0.805831\n[29]  1.399509  0.000000  0.805831  0.000000  1.399509 -2.357143  0.000000\n[36]  1.887150  1.399509  2.308577  4.407118  2.683787  1.887150  1.399509\n[43]  2.308577  2.308577  2.308577  2.308577  0.805831  1.887150  1.399509\n[50]  2.308577  1.399509  2.308577  1.399509  2.683787  0.000000  0.000000\n[57]  1.399509  0.805831  2.683787  1.887150  4.161975  3.629951  5.078760\n[64]  6.390651  5.078760  5.285168  4.640760  3.903635  7.033117  7.033117\n[71]  6.719601  4.640760\n```\n\n\n:::\n\n```{.r .cell-code}\n#Es el dato que se va a utilizar para la transformacion\n#Si lambda es 0.5 es igual que hacer la raiz cuadrada.\n```\n:::\n\n\n## Alternativa 2 - no parametrico\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(agricolae)\nkruskal.test(count ~ spray,\n             data = insecticida)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tKruskal-Wallis rank sum test\n\ndata:  count by spray\nKruskal-Wallis chi-squared = 54.691, df = 5, p-value = 1.511e-10\n```\n\n\n:::\n\n```{.r .cell-code}\n#las medias no son iguales, pues se rechaza la hipotesis nula\nKAgric<-kruskal(insecticida$count,\n        insecticida$spray,\n        group = TRUE)\n#El group es para colocar los grupos con el test de Fischer.\nKAgric\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$statistics\n     Chisq Df      p.chisq  t.value      MSD\n  54.69134  5 1.510845e-10 1.996564 8.462804\n\n$parameters\n            test p.ajusted            name.t ntr alpha\n  Kruskal-Wallis      none insecticida$spray   6  0.05\n\n$means\n  insecticida.count     rank      std  r Min Max   Q25  Q50   Q75\nA         14.500000 52.16667 4.719399 12   7  23 11.50 14.0 17.75\nB         15.333333 54.83333 4.271115 12   7  21 12.50 16.5 17.50\nC          2.083333 11.45833 1.975225 12   0   7  1.00  1.5  3.00\nD          4.916667 25.58333 2.503028 12   2  12  3.75  5.0  5.00\nE          3.500000 19.33333 1.732051 12   1   6  2.75  3.0  5.00\nF         16.666667 55.62500 6.213378 12   9  26 12.50 15.0 22.50\n\n$comparison\nNULL\n\n$groups\n  insecticida$count groups\nF          55.62500      a\nB          54.83333      a\nA          52.16667      a\nD          25.58333      b\nE          19.33333     bc\nC          11.45833      c\n\nattr(,\"class\")\n[1] \"group\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#El metodo no parametrico dio la misma respuesta que el metodo transformado para el metodo parametrico.\n```\n:::\n\n\n## Alternativa 3 GLMs\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm4 <- glm(count~spray,\n          family= poisson,\n          data = insecticida)\n\n#La distribucion se ajusta bien a poisson por la numerica discreta, al testar esto, se da una desviacion Dice que el valor de Anova es significativo, diciendo que uno dio diferente a los otros.\n#Al hacerse todo l\nsummary(m4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = count ~ spray, family = poisson, data = insecticida)\n\nCoefficients:\n            Estimate Std. Error z value Pr(>|z|)    \n(Intercept)  2.67415    0.07581  35.274  < 2e-16 ***\nsprayB       0.05588    0.10574   0.528    0.597    \nsprayC      -1.94018    0.21389  -9.071  < 2e-16 ***\nsprayD      -1.08152    0.15065  -7.179 7.03e-13 ***\nsprayE      -1.42139    0.17192  -8.268  < 2e-16 ***\nsprayF       0.13926    0.10367   1.343    0.179    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 409.041  on 71  degrees of freedom\nResidual deviance:  98.329  on 66  degrees of freedom\nAIC: 376.59\n\nNumber of Fisher Scoring iterations: 5\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(car)\nAnova(m4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Deviance Table (Type II tests)\n\nResponse: count\n      LR Chisq Df Pr(>Chisq)    \nspray   310.71  5  < 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(simulateResiduals(m4))\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n\n```{.r .cell-code}\nm4_medias<- emmeans(m4,~spray,\n                    type = 'response')\nm4_medias\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n spray  rate    SE  df asymp.LCL asymp.UCL\n A     14.50 1.099 Inf     12.50     16.82\n B     15.33 1.130 Inf     13.27     17.72\n C      2.08 0.417 Inf      1.41      3.08\n D      4.92 0.640 Inf      3.81      6.35\n E      3.50 0.540 Inf      2.59      4.74\n F     16.67 1.179 Inf     14.51     19.14\n\nConfidence level used: 0.95 \nIntervals are back-transformed from the log scale \n```\n\n\n:::\n\n```{.r .cell-code}\n#Asymp habla de que todas las respuestas estan en este rango\n\ncld(m4_medias)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n spray  rate    SE  df asymp.LCL asymp.UCL .group\n C      2.08 0.417 Inf      1.41      3.08  1    \n E      3.50 0.540 Inf      2.59      4.74  12   \n D      4.92 0.640 Inf      3.81      6.35   2   \n A     14.50 1.099 Inf     12.50     16.82    3  \n B     15.33 1.130 Inf     13.27     17.72    3  \n F     16.67 1.179 Inf     14.51     19.14    3  \n\nConfidence level used: 0.95 \nIntervals are back-transformed from the log scale \nP value adjustment: tukey method for comparing a family of 6 estimates \nTests are performed on the log scale \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n:::\n\n\n## Anova Factorial\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gsheet)\nli <- gsheet2tbl('https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=2023059672')\n\n#Severidad en funcion a tratamientos\nli |>\n  ggplot(aes(factor(dose), severity, color = factor (dose)))+\n  geom_jitter(width=0.1)+\n  facet_wrap(~treat)\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\n## Modelo factorial (twoway anova)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmf <- lm(severity ~ treat*factor(dose),\n         data= li)\nmf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = severity ~ treat * factor(dose), data = li)\n\nCoefficients:\n                    (Intercept)                treatTebuconazole  \n                         0.2921                          -0.2711  \n                  factor(dose)2  treatTebuconazole:factor(dose)2  \n                        -0.2420                           0.2412  \n```\n\n\n:::\n\n```{.r .cell-code}\nanova(mf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: severity\n                   Df   Sum Sq  Mean Sq F value    Pr(>F)    \ntreat               1 0.113232 0.113232  30.358 4.754e-05 ***\nfactor(dose)        1 0.073683 0.073683  19.755 0.0004077 ***\ntreat:factor(dose)  1 0.072739 0.072739  19.502 0.0004326 ***\nResiduals          16 0.059678 0.003730                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\n#podemos ver que la interaccion entre dosis y tratamiento no es significativa.\n#Las letras mayusculas comparan Los pesticidas y la minuscula compara los dosajes.\n#Antes de todo esto, debemos testar las premisas.\n\nplot(simulateResiduals(mf))\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n\n```{.r .cell-code}\ncheck_normality(mf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nWarning: Non-normality of residuals detected (p = 0.011).\n```\n\n\n:::\n\n```{.r .cell-code}\ncheck_heteroscedasticity(mf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nWarning: Heteroscedasticity (non-constant error variance) detected (p < .001).\n```\n\n\n:::\n\n```{.r .cell-code}\n#Viendo los dosajes de los tratamientos\nmf_medias <- emmeans(mf, ~ dose | treat)\ncld(mf_medias)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntreat = Ionic liquid:\n dose emmean     SE df lower.CL upper.CL .group\n  2.0 0.0501 0.0273 16 -0.00781   0.1080  1    \n  0.5 0.2921 0.0273 16  0.23420   0.3500   2   \n\ntreat = Tebuconazole:\n dose emmean     SE df lower.CL upper.CL .group\n  2.0 0.0202 0.0273 16 -0.03768   0.0781  1    \n  0.5 0.0210 0.0273 16 -0.03690   0.0789  1    \n\nConfidence level used: 0.95 \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n\n```{.r .cell-code}\n#Viendo los pesticidas segun el tratamiento\nmf_medias2 <- emmeans(mf, ~ treat | dose)\ncld(mf_medias2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ndose = 0.5:\n treat        emmean     SE df lower.CL upper.CL .group\n Tebuconazole 0.0210 0.0273 16 -0.03690   0.0789  1    \n Ionic liquid 0.2921 0.0273 16  0.23420   0.3500   2   \n\ndose = 2.0:\n treat        emmean     SE df lower.CL upper.CL .group\n Tebuconazole 0.0202 0.0273 16 -0.03768   0.0781  1    \n Ionic liquid 0.0501 0.0273 16 -0.00781   0.1080  1    \n\nConfidence level used: 0.95 \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}